<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="shortcut icon" href="#" />
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panic Lab</title>
</head>
<body>
    <h1>Pr√≥ba page</h1>
    <button id = "btnCreate">New game</button>
    <input type = "text" id = "inptGameId" style = "width:300px">
    <button id = "btnJoin">Join game</button>
    <button id = "btnStart">Start game</button>
    <button id = "btnRoll">Roll dice</button>
    <button id = "btnChoose">Choose card</button>

    <script>
        //TODO: store the Id-s in cookies
        let playerId = null;
        let gameId = null;
        let ws = new WebSocket("ws://"+window.location.hostname+":9090");
        
        const btnCreate = document.getElementById("btnCreate");
        const inptGameId = document.getElementById("inptGameId");
        const btnJoin = document.getElementById("btnJoin");
        const btnStart = document.getElementById("btnStart");
        const btnRoll = document.getElementById("btnRoll");
        const btnChoose = document.getElementById("btnChoose");

        btnJoin.addEventListener("click", e =>{
            if(gameId === null){
                gameId = inptGameId.value;
            }
            const payLoad = {
                "method": "join",
                "playerId": playerId,
                "gameId": gameId
            }

            ws.send(JSON.stringify(payLoad));
        });


        btnCreate.addEventListener("click", e =>{
            const payLoad = {
                "method": "create",
                "playerId": playerId
            }

            ws.send(JSON.stringify(payLoad));
        });

        btnStart.addEventListener("click", e =>{
            const payLoad = {
                "method": "start",
                "gameId": gameId
            }

            ws.send(JSON.stringify(payLoad));
        });

        btnRoll.addEventListener("click", e =>{
            const payLoad = {
                "method": "roll",
                "playerId": playerId,
                "gameId": gameId
            }

            ws.send(JSON.stringify(payLoad));
        });
        
        btnChoose.addEventListener("click", e =>{
            //For debuggin, the chosen card is random
            const payLoad = {
                "method": "choose",
                "playerId": playerId,
                "gameId": gameId,
                "card": Math.floor(Math.random() * 25)
            }
            ws.send(JSON.stringify(payLoad));
        });

        ws.onmessage = message => {
            //message.data
            const response = JSON.parse(message.data);
            
            if (response.method === "connect"){
                playerId = response.playerId;
                console.log("player id set: " + playerId);
            }

            if (response.method === "create"){
                const game = response.game;
                gameId = game.id;
                document.getElementById("inptGameId").value = gameId;
                console.log(game);
            }

            if (response.method === "join"){
                players = response.players;
                console.log(players)
            }

            if (response.method === "start"){
                const game = response.game;
                console.log(game)
            }

            if (response.method === "roll"){
                const dices = response.dices;
                console.log(dices)
            }

            if (response.method === "choose"){
                const players = response.players;
                console.log(players)
            }
        };
    </script>
</body>
</html>
